<!DOCTYPE html>
<html xml:lang="ja" lang="ja">
<head>
  <title>camp2025</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="img/favicon.png">
  <style type="text/css">
body {
      font-size: 1rem;
      line-height: 1.6;
      margin: 0;
      /*padding: 1rem;*/
      font-family: Arial, sans-serif;
      overflow-x: hidden;
    }
    *,
    *::before,
    *::after {
      box-sizing: border-box;
    }
    
    h1 {
      position: relative;
      color: #158b2b;
      font-size: 20px;
      padding: 10px 0;
      text-align: center;
    }
    h1:before {
      content: "";
      position: absolute;
      top: -8px;
      left: 50%;
      width: min(150px, 80%);
      height: 58px;
      border-radius: 50%;
      border: 5px solid #a6ddb0;
      border-left-color: transparent;
      border-right-color: transparent;
      transform: translateX(-50%);
      box-sizing: border-box;
    }
    
    h2 {
      border-bottom: solid 3px #cce4ff;
      position: relative;
      width: max(150px, 80%);
    }
    
    h2:after {
      position: absolute;
      content: " ";
      display: block;
      border-bottom: solid 3px #5472cd;
      bottom: -3px;
      width: 20%;
    }
    
    .mainView a {
      color: #00f;
      background-color: #ddf;
      font-weight: 600;
    }
    li,p {width: max(150px,calc(100vw-2rem))}
table.header td {border: none;}
    a{
      color: #040404;
      text-decoration: none;
    }
    .mainView{
      width: 100vw;
      height: 100vh;
      background-color: #fff; /*original: #ccc;*/
    }
    /*ハンバーガーボタン*/
    .el_humburger {
      position: fixed;
      top: 45px;
      right: 60px;
      width: 46px;
      height: 25px;
      padding-top: 1px;
      -webkit-box-sizing: border-box;
      box-sizing: border-box;
      padding-top: 0px;
      z-index: 20;
      cursor: pointer;
      pointer-events: auto;
      color: #000;
      text-align: center;}
    
    @media screen and (max-width: 840px) {
      .el_humburger {
        display: block;
        right: 0;
        top: 0;
        padding-top: 20px;
        width: 70px;
        height: 70px;}
        #factory .el_humburger {
          display: none; } }
    
    .el_humburger_wrapper {
      margin-bottom: 5px;
      width: 42px;
      display: inline-block; }
    
    @media screen and (max-width: 840px) {
      .el_humburger_wrapper {
        margin-bottom: 5px;
        width: 30px; } }
    
    .el_humburger_text {
      font-size: 12px;
      letter-spacing: 0.1em;
      font-family: "游ゴシック Medium", YuGothic, "Yu Gothic", "ヒラギノ角ゴ Pro", "Hiragino Kaku Gothic Pro", "メイリオ", Meiryo, sans-serif; }
    
    .js_humburgerOpen .el_humburger_text.el_humburger_text__menu {
      display: none; }
    
    .el_humburger_text.el_humburger_text__close {
      display: none; }
    
    .js_humburgerOpen .el_humburger_text.el_humburger_text__close {
      display: block; }
    
    @media screen and (max-width: 840px) {
      .el_humburger_text {
        font-size: 10px;
        padding-top: 2px; } }
    
    @media screen and (max-width: 840px) {
      .el_humburger_text svg path {
        -webkit-transition: all 200ms cubic-bezier(0.16, 0.52, 0.25, 1);
        -o-transition: all 200ms cubic-bezier(0.16, 0.52, 0.25, 1);
        transition: all 200ms cubic-bezier(0.16, 0.52, 0.25, 1);
        fill: #000; } }
    
    @media screen and (max-width: 840px) {
      .js_humburgerOpen .el_humburger_text svg path {
        fill: #000; } }
    
    .el_humburger span.el_humburger_bar {
      display: block;
      width: 100%;
      margin: 0 auto 9px;
      height: 1px;
      background: #000;
      -webkit-transition: all .2s ease-in-out;
      -o-transition: all .2s ease-in-out;
      transition: all .2s ease-in-out; }
    
    .el_humburger span.el_humburger_bar:last-child {
      margin-bottom: 0; }
    
    .js_humburgerOpen .el_humburger span.el_humburger_bar {
      background: #000; }
    
    @media screen and (max-width: 840px) {
      .el_humburger span.el_humburger_bar {
        left: 0;
        top: 0;
        background: #000; } }
    
    .js_humburgerOpen .el_humburger span.el_humburger_bar.top {
      -webkit-transform: translateY(9px) rotate(-45deg);
      -ms-transform: translateY(9px) rotate(-45deg);
      transform: translateY(9px) rotate(-45deg); }
    
    .js_humburgerOpen .el_humburger span.el_humburger_bar.middle {
      opacity: 0; }
    
    .js_humburgerOpen .el_humburger span.el_humburger_bar.bottom {
      -webkit-transform: translateY(-11px) rotate(45deg);
      -ms-transform: translateY(-11px) rotate(45deg);
      transform: translateY(-11px) rotate(45deg); }
    
    .el_humburgerButton.el_humburgerButton__close {
      top: 2%;
      right: 2%; }
    
    .el_humburgerButton__close span.el_humburger_bar {
      display: block;
      width: 35px;
      margin: 0 auto;
      height: 4px;
      background: #000; }
    
    .el_humburgerButton__close span.el_humburger_bar.top {
      -webkit-transform: translateY(5px) rotate(-45deg);
      -ms-transform: translateY(5px) rotate(-45deg);
      transform: translateY(5px) rotate(-45deg); }
    
    .el_humburgerButton__close span.el_humburger_bar.bottom {
      -webkit-transform: translateY(-6px) rotate(45deg);
      -ms-transform: translateY(-6px) rotate(45deg);
      transform: translateY(-6px) rotate(45deg); }
    
    .navi {
      position: fixed;
      right: 0;
      height: 100%;
      background-color: rgba(223,223,223,0.95);/*original: rgba(255, 255, 255, 0.9);*/
      width: 450px;
      z-index: 3;
      padding-top: 100px;
      -webkit-box-sizing: border-box;
      box-sizing: border-box;
      -webkit-transition: all 600ms ease-out;
      -o-transition: all 600ms ease-out;
      transition: all 600ms ease-out;
      transform:translateZ(0) translateX(100%);
      overflow: auto; }
      .js_humburgerOpen .navi {
        transform:translateZ(0) translateX(0); }
        @media screen and (max-width: 840px) {
          .navi {
            padding: 100px 5% 0; }
          .js_humburgerOpen .navi {
            width: 100%;} }
    
    .navi_item {
      position:relative;
      margin-bottom: 28px;
      font-size: 20px;
      /*font-family: "Marcellus", serif !important;*/
      padding-left: 2rem;
      white-space: nowrap;
      margin-left: 90px; }
      .navi_item.op_innerLink {
        cursor: pointer; }
      @media screen and (max-width: 840px) {
        .navi_item {
          margin-left: 0;
          font-size: 18px; } }
    
    
    
    .el_spChildNavOpen {
      position: absolute;
      top: -6px;
      left: 80%;
      z-index: 20;
      -webkit-transition: all 200ms ease-out;
      -o-transition: all 200ms ease-out;
      transition: all 200ms ease-out;
      -webkit-transform-origin: center;
      -ms-transform-origin: center;
      transform-origin: center;
      padding: 10px; }
    
    .js_openParent.js_fire > .el_spChildNavOpen {
      -webkit-transform: rotate(180deg);
      -ms-transform: rotate(180deg);
      transform: rotate(180deg); }
      .js_openParent.js_fire > .el_spChildNavOpen > .el_spChildNavOpen_wrapper:after {
        -webkit-transform: rotate(90deg);
        -ms-transform: rotate(90deg);
        transform: rotate(90deg);
        opacity: 0; }
    
    .el_spChildNavOpen_wrapper {
      position: relative;
      width: 15px;
      height: 15px;
      -webkit-transition: all 200ms ease-out;
      -o-transition: all 200ms ease-out;
      transition: all 200ms ease-out;
      -webkit-transform-origin: center;
      -ms-transform-origin: center;
      transform-origin: center; }
      .el_spChildNavOpen_wrapper:before {
        content: "";
        width: 100%;
        height: 1px;
        background-color: #111;
        position: absolute;
        top: calc(50% - 1px); }
      .el_spChildNavOpen_wrapper:after {
        content: "";
        width: 1px;
        height: 100%;
        background-color: #111;
        position: absolute;
        left: calc(50% - 1px);
        -webkit-transition: all 200ms ease-out;
        -o-transition: all 200ms ease-out;
        transition: all 200ms ease-out; }
    
    
    .nav_child{
      padding-top:20px;
    }
    
    .nav_child_item{
      position: relative;
      font-size:16px;
      padding-left:20px;
      margin-bottom:10px;
    }
    
    .nav_child_item > a{
      position:absolute;
      left:0;
      right:0;
      bottom:0;
      top:0;
    }
    
    .nav_child_item:last-child{
      margin-bottom:0px;
    }
    
    .js_openSwitch {
      cursor: pointer; }
    
    .js_openTarget {
      display: none; }
/* 集計表関係 */
    .summary table {margin: 1rem auto;}
    .summary .vertical {
      writing-mode: vertical-rl; /* 右から左に縦書き */
      text-orientation: upright; /* 文字の向きを正立にする（漢字など） */
      white-space: nowrap;       /* 折り返さない */
    }
    .summary th, td {
      font-size: 1rem;
      font-weight: normal;
      color: #000;
      border-top: solid 1px #bbb;
      border-left: solid 1px #bbb;
      border-right: solid 1px #888;
      border-bottom: solid 1px #888;
      padding: 5px;
    }
    .summary th {
      text-align: left;
      background-color: #ddd;
    }
    .summary td {
      text-align: right;
    }
    .summary .sum {background-color: #bff;}
    
    /* グラフ関係はアクセス数集計のそれを流用 */
    .graph table {
      width: 90%;
      margin: 1rem auto;
    }
    .graph td {
      padding: 0;
      line-height: 0.5rem;
      vertical-align: middle;
      border: none;
    }
    .graph td.label {
      font-size:0.8rem;
      width: 2rem;
      white-space: nowrap;
    }
    .graph td.bar {
      height: 1rem;
      line-height: 0.85rem;
      padding: 0 auto 0 0;
    }
    .graph span {
      display: inline-block;
      height: 1rem;
      color: #080;
      background: #0f8;
      font-size:0.7rem;
    }
  </style>
  <script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
</head>
<body>
<table class="header"><tr><td>
    <a href="index.html">
      <img src="img/siteHeader.png" width="85%" />
    </a>
  </td><td>
    <div class="el_humburger"><!--ハンバーガーボタン-->
      <div class="el_humburger_wrapper">
        <span class="el_humburger_bar top"></span>
        <span class="el_humburger_bar middle"></span>
        <span class="el_humburger_bar bottom"></span>
      </div>
    </div>
  </td></tr></table>
  
  
  <header class="navi">
    <div class="navi_inner">
      <div class="navi_item"><a href="./index.html">ホーム</a></div>
      <div class="navi_item"><a href="./guideline.html">持ち物・注意事項</a></div>
      <div class="navi_item"><a href="./timetable.html">タイムテーブル</a></div>
      <div class="navi_item"><a href="./map.html">会場マップ</a></div>
      <div class="navi_item js_openParent"><a href="">リンク集</a>
          <div class="el_spChildNavOpen js_openSwitch">
            <div class="el_spChildNavOpen_wrapper"></div>
          </div>
          <div class="nav_child js_openTarget">
            <div class="nav_child_item">
              <a class="hp_coverLink" href="https://forms.gle/H9AsmubNVR9B3raM8" target="_blank"></a>
              参加申込フォーム
            </div>
            <div class="nav_child_item">
              <a class="hp_coverLink" href="https://line.me/ti/g2/uvGidv-6G5WmYg-fNnW2i7uGdFUCw_JBQC6YyQ?utm_source=invitation&utm_medium=link_copy&utm_campaign=default" target="_blank"></a>
              LINEオープンチャット
            </div>
            <div class="nav_child_item">
              <a class="hp_coverLink" href="https://forms.gle/NDMHnKemZxasKdMf6" target="_blank"></a>
              参加者アンケート
            </div>
            <div class="nav_child_item">
              <a class="hp_coverLink" href="https://docs.google.com/forms/d/e/1FAIpQLSfbqa_vRBQYjsn2cYkPHbsc2-xSa0AFU6AwgZMIMKAKPxcyEQ/viewform" target="_blank"></a>
              おやじの会ML新規登録
            </div>
          </div>
          <div class="bl_nav_item_spToggle"></div>
      </div>
      <div class="navi_item js_openParent"><a href="">スタッフ用</a>
          <div class="el_spChildNavOpen js_openSwitch">
            <div class="el_spChildNavOpen_wrapper"></div>
          </div>
          <div class="nav_child js_openTarget">
            <div class="nav_child_item">
              <a class="hp_coverLink" href="totalNumberOfParticipants.html"></a>
              応募者数集計
            </div>
            <div class="nav_child_item">
              <a class="hp_coverLink" href="accessLog.html"></a>
              アクセス数集計
            </div>
            <div class="nav_child_item">
              <a class="hp_coverLink" href="tentSection.html"></a>
              テント区画
            </div>
            <div class="nav_child_item">
              <a class="hp_coverLink" href="https://forms.gle/APUHcSJnFHjkQCuq5" target="_blank"></a>
              気づき投稿
            </div>
          </div>
          <div class="bl_nav_item_spToggle"></div>
      </div>
    </div>
  </header>

  <div class="mainView">
<h2>応募者数集計</h2>
  <div class="summary">
    <div class="participant"></div>
    <div class="staff" style="margin-top: 2rem;"></div>
  </div>
  
  <h2>日別応募数の推移</h2>
  <p>※ 日付は04:00〜28:00で区切り</p>
  <div id="dailyGraph" class="graph"></div>
  
  <h2>時間帯別応募数</h2>
  <div id="hourlyGraph" class="graph"></div>
  </div>

</body>
<script type="text/javascript">
const config = {
  systemName: 'camp2025',
  publicSheetAPI:'https://script.google.com/macros/s/AKfycbxO_NzZBH2BnS6zaNZD54okTXk74xSCoFk8r_0aE5SjyWsFMRHE8GHP2e_fU2gOHC_0Gg/exec',
};
//変数定義
var navigationOpenFlag = false;
var navButtonFlag = true;
var focusFlag = false;

//toggle
$(function(){
  $(document).on('click','.js_openSwitch',function(){
    $(this).parent('.js_openParent').find(' > .js_openTarget').slideToggle("fast");
    $(this).parent('.js_openParent').toggleClass('js_fire');
  });
});

//ハンバーガーメニュー
$(function(){

  $(document).on('click','.el_humburger',function(){
    if(navButtonFlag){
      spNavInOut.switch();
      //一時的にボタンを押せなくする
      setTimeout(function(){
        navButtonFlag = true;
      },200);
      navButtonFlag = false;
    }
  });
  $(document).on('click touchend', function(event) {
    if (!$(event.target).closest('.navi,.el_humburger').length && $('body').hasClass('js_humburgerOpen') && focusFlag) {
      focusFlag = false;
      //scrollBlocker(false);
      spNavInOut.switch();
    }
  });
});

//ナビ開く処理
function spNavIn(){
  $('body').removeClass('js_humburgerClose');
  $('body').addClass('js_humburgerOpen');
  setTimeout(function(){
    focusFlag = true;
  },200);
  setTimeout(function(){
    navigationOpenFlag = true;
  },200);
}

//ナビ閉じる処理
function spNavOut(){
  $('body').removeClass('js_humburgerOpen');
  $('body').addClass('js_humburgerClose');
  setTimeout(function(){
    $(".uq_spNavi").removeClass("js_appear");
    focusFlag = false;
  },200);
  navigationOpenFlag = false;
}

//ナビ開閉コントロール
var spNavInOut = {
  switch:function(){
    if($('body.spNavFreez').length){
      return false;
    }
    if($('body').hasClass('js_humburgerOpen')){
     spNavOut();
    } else {
     spNavIn();
    }
  }
};
/** fetchPublic: 「公開用」全シートの読み込み＋localStorageへの保存
 * @param {void}
 * @returns {Object} {シート名:行オブジェクトの配列}形式のオブジェクト
 */
function fetchPublic(func='notice') {
  console.log('fetchPublic start.');
  return fetch(config.publicSheetAPI+`?func=${func}`).then(response => {
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    return response.json(); // JSONに変換
  })
  .then(jsonData => {
    // localStorage に保存（文字列に変換）
    localStorage.setItem(config.systemName, JSON.stringify(jsonData));
    console.log('fetchPublic end.',jsonData);
    return jsonData; // jsonDataをPromiseの結果として返す
  });
}
/** HTMLElementを生成する
 * @param {CEDefObj|CEDefObj[]} arg - 生成するHTMLElementの定義
 * @param {HTMLElement|string} [parent=null] - 本関数内部で親要素への追加まで行う場合に指定
 * @returns {HTMLElement|Error}
 */
function createElement(arg,parent=null){
  const v = {whois:'BasePage.createElement',rv:[],step:0};
  //console.log(v.whois+' start.',arg);
  try {
    v.step = 1.1; // 引数を強制的に配列化
    v.isArr = Array.isArray(arg); // 引数が配列ならtrue。戻り値にも使用するので保存
    if( !v.isArr ) arg = [arg];
    v.step = 1.2; // 親要素の特定
    if( parent !== null ){
      v.parent = typeof parent === 'string' ? document.querySelector(parent) : parent;
    }


    for( v.i = 0 ; v.i<arg.length ; v.i++ ){
      v.step = 2; // 既定値の設定
      v.def = {tag: 'div',attr: {},style:{},event:{},text: '',html:'',children:[],name:''};
      Object.assign(v.def,(typeof arg[v.i] === 'string' ? {tag:arg} : arg[v.i]))

      v.step = 3; // HTMLElementを生成、v.objとする
      v.obj = document.createElement(v.def.tag);

      v.step = 4; // HTMLElementの属性を定義
      for( v.j in v.def.attr ){
        v.obj.setAttribute(v.j,v.x = v.def.attr[v.j]);
      }

      v.step = 5; // 論理属性を定義(ex.checked)
      for( v.j in v.def.logical ){
        if( v.def.logical[v.j] ){
          v.obj.setAttribute(v.j,v.def.logical[v.j]);
        }
      }

      v.step = 6; // style属性の定義
      for( v.j in v.def.style ){
        if( v.j.match(/^\-\-/) ){ // CSS変数
          v.obj.style.setProperty(v.j,v.def.style[v.j]);
        } else {
          v.obj.style[v.j] = v.def.style[v.j];
        }
      }

      v.step = 7; // イベントの定義
      for( v.j in v.def.event ){
        v.obj.addEventListener(v.j,v.def.event[v.j],false);
      }

      v.step = 8; // 内部文字列(html or text)
      if( v.def.html.length > 0 ){
        v.obj.innerHTML = v.def.html;
      } else {
        // textareaの場合はvalueに、それ以外はinnerTextに内部文字列(text)をセット
        v.obj[v.def.tag.toLowerCase()==='textarea'?'value':'innerText'] = v.def.text;
      }

      v.step = 9; // 子要素の追加(parentは指定しない)
      for( v.j=0 ; v.j<v.def.children.length ; v.j++ ){
        v.obj.appendChild(this.createElement(v.def.children[v.j]));
      }

      v.step = 10; // 戻り値への登録
      v.rv.push(v.obj);

      v.step = 11; // 親要素への追加
      if( parent !== null ){
        v.parent.appendChild(v.obj);
      }

      v.step = 12; // メンバとして、また切替画面として登録
      if( v.def.name.length > 0 ){
        this[v.def.name] = v.obj;
        this.screenList[v.def.name] = v.obj;
      }
    }

    v.step = 12; // 配列で渡されたら配列で、オブジェクトならオブジェクトを返す
    v.rv = v.isArr ? v.rv : v.rv[0];
    //console.log(v.whois+' normal end.\n',v.rv);
    return v.rv;

  } catch(e){
    console.error(v.whois+' abnormal end(step.'+v.step+').',e,v);
    return e;
  }
}
/** devTools: 開発支援関係メソッド集
 * @param {Object} option
 * @param {boolean} option.start=true - 開始・終了メッセージの表示
 * @param {boolean} option.arg=true - 開始時に引数を表示
 * @param {boolean} option.step=false - step毎の進捗ログの出力
 */
function devTools(option) {
  let opt = Object.assign({ start: true, arg: true, step: false }, option);
  let seq = 0;  // 関数の呼出順
  let stack = []; // 呼出元関数情報のスタック
  return { changeOption: changeOption, check: check, dump: dump, end: end, error: error, start: start, step: step };

  /** オプションの変更 */
  function changeOption(option) {
    opt = Object.assign(opt, option);
    console.log(`devTools.changeOption result: ${JSON.stringify(opt)}`);
  }
  /** 実行結果の確認
   * - JSON文字列の場合、オブジェクト化した上でオブジェクトとして比較する
   * @param {Object} arg
   * @param {any} arg.asis - 実行結果
   * @param {any} arg.tobe - 確認すべきポイント(Check Point)。エラーの場合、エラーオブジェクトを渡す
   * @param {string} arg.title='' - テストのタイトル(ex. SpreadDbTest.delete.4)
   * @param {Object} [arg.opt] - isEqualに渡すオプション
   * @returns {boolean} - チェック結果OK:true, NG:false
   */
  function check(arg = {}) {
    /** recursive: 変数の内容を再帰的にチェック
     * @param {any} asis - 結果の値
     * @param {any} tobe - 有るべき値
     * @param {Object} opt - isEqualに渡すオプション
     * @param {number} depth=0 - 階層の深さ
     * @param {string} label - メンバ名または添字
     */
    const recursive = (asis, tobe, opt, depth = 0, label = '') => {
      let rv;
      // JSON文字列はオブジェクト化
      asis = (arg => { try { return JSON.parse(arg) } catch { return arg } })(asis);
      // データ型の判定
      let type = String(Object.prototype.toString.call(tobe).slice(8, -1));
      switch (type) {
        case 'Number': if (Number.isNaN(tobe)) type = 'NaN'; break;
        case 'Function': if (!('prototype' in tobe)) type = 'Arrow'; break;
      }
      let indent = '  '.repeat(depth);
      switch (type) {
        case 'Object':
          msg.push(`${indent}${label.length > 0 ? label + ': ' : ''}{`);
          for (let mn in tobe) {
            rv = !Object.hasOwn(asis, mn) ? false // 該当要素が不在
              : recursive(asis[mn], tobe[mn], opt, depth + 1, mn);
          }
          msg.push(`${indent}}`);
          break;
        case 'Array':
          msg.push(`${indent}${label.length > 0 ? label + ': ' : ''}[`);
          for (let i = 0; i < tobe.length; i++) {
            rv = (asis[i] === undefined && tobe[i] !== undefined) ? false // 該当要素が不在
              : recursive(asis[i], tobe[i], opt, depth + 1, String(i));
          }
          msg.push(`${indent}]`);
          break;
        case 'Function': case 'Arrow':
          rv = tobe(asis);  // 合格ならtrue, 不合格ならfalseを返す関数を定義
          msg.push(
            indent + (label.length > 0 ? (label + ': ') : '')
            + (rv ? asis : `[NG] (${tobe.toString()})(${asis}) -> false`)
          );
          break;
        default:
          if (tobe === undefined) {
            rv = true;
          } else {
            rv = isEqual(asis, tobe, opt);
            msg.push(
              indent + (label.length > 0 ? (label + ': ') : '')
              + (rv ? asis : `[NG] ToBe=${tobe}, AsIs=${asis}`)
            );
          }
      }
      return rv;
    }

    // 主処理
    let msg = [];
    let isOK = true;  // チェックOKならtrue

    arg = Object.assign({ msg: '', opt: {} }, arg);
    if (arg.tobe === undefined) {
      // check未指定の場合、チェック省略、結果表示のみ
      msg.push(`===== ${arg.title} Check Result : Not checked`);
    } else {
      // arg.asisとarg.tobeのデータ型が異なる場合、またはrecursiveで不一致が有った場合はエラーと判断
      if (String(Object.prototype.toString.call(arg.asis).slice(8, -1))
        !== String(Object.prototype.toString.call(arg.tobe).slice(8, -1))
        || recursive(arg.asis, arg.tobe, arg.opt) === false
      ) {
        isOK = false;
        msg.unshift(`===== ${arg.title} Check Result : Error`);
      } else {
        msg.unshift(`===== ${arg.title} Check Result : OK`);
      }
    }

    // 引数として渡されたmsgおよび結果(JSON)を先頭に追加後、コンソールに表示
    msg = `::::: Verified by devTools.check\n`
      + `===== ${arg.title} Returned Value\n`
      + JSON.stringify(arg.asis, (k, v) => typeof v === 'function' ? v.toString() : v, 2)
      + `\n\n\n${msg.join('\n')}`;
    if (isOK) console.log(msg); else console.error(msg);
    return isOK;
  }
  /** dump: 渡された変数の内容をコンソールに表示
   * - 引数には対象変数を列記。最後の引数が数値だった場合、行番号と看做す
   * @param {any|any[]} arg - 表示する変数および行番号
   * @returns {void}
   */
  function dump() {
    let arg = [...arguments];
    let line = typeof arg[arg.length - 1] === 'number' ? arg.pop() : null;
    const o = stack[stack.length - 1];
    let msg = (line === null ? '' : `l.${line} `)
      + `::dump::${o.label}.${o.step}`;
    for (let i = 0; i < arg.length; i++) {
      // 対象変数が複数有る場合、Noを追記
      msg += '\n' + (arg.length > 0 ? `${i}: ` : '') + stringify(arg[i]);
    }
    console.log(msg);
  }
  /** end: 正常終了時の呼出元関数情報の抹消＋終了メッセージの表示
   * @param {Object} rt - end実行時に全体に優先させるオプション指定(run time option)
   */
  function end(rt={}) {
    const localOpt = Object.assign({},opt,rt);
    const o = stack.pop();
    if (localOpt.start) console.log(`${o.label} normal end.`);
  }
  /** error: 異常終了時の呼出元関数情報の抹消＋終了メッセージの表示 */
  function error(e) {
    const o = stack.pop();
    // 参考 : e.lineNumber, e.columnNumber, e.causeを試したが、いずれもundefined
    e.message = `[Error] ${o.label}.${o.step}\n${e.message}`;
    console.error(e.message
      + `\n-- footprint\n${o.footprint}`
      + `\n-- arguments\n${o.arg}`
    );
  }
  /** start: 呼出元関数情報の登録＋開始メッセージの表示
   * @param {string} name - 関数名
   * @param {any[]} arg - start呼出元関数に渡された引数([...arguments]固定)
   * @param {Object} rt - start実行時に全体に優先させるオプション指定(run time option)
   */
  function start(name, arg = [], rt={}) {
    const localOpt = Object.assign({},opt,rt);
    const o = {
      class: '',  // nameがクラス名.メソッド名だった場合のクラス名
      name: name,
      seq: seq++,
      step: 0,
      footprint: [],
      arg: [],
    };
    o.sSeq = ('000' + o.seq).slice(-4);
    const caller = stack.length === 0 ? null : stack[stack.length - 1]; // 呼出元
    // nameがクラス名.メソッド名だった場合、クラス名をセット
    if (name.includes('.')) [o.class, o.name] = name.split('.');
    // ラベル作成。呼出元と同じクラスならクラス名は省略
    o.label = `[${o.sSeq}]` + (o.class && (!caller || caller.class !== o.class) ? o.class+'.' : '') + o.name;
    // footprintの作成
    stack.forEach(x => o.footprint.push(`${x.label}.${x.step}`));
    o.footprint = o.footprint.length === 0 ? '(root)' : o.footprint.join(' > ');
    // 引数情報の作成
    if (arg.length === 0) {
      o.arg = '(void)';
    } else {
      for (let i = 0; i < arg.length; i++) o.arg[i] = stringify(arg[i]);
      o.arg = o.arg.join('\n');
    }
    // 作成した呼出元関数情報を保存
    stack.push(o);

    if (localOpt.start) {  // 開始メッセージの表示指定が有った場合
      console.log(`${o.label} start.\n-- footprint\n${o.footprint}`
        + (localOpt.arg ? `\n-- arguments\n${o.arg}` : ''));
    }
  }
  /** step: 呼出元関数の進捗状況の登録＋メッセージの表示 */
  function step(step, msg = '') {
    const o = stack[stack.length - 1];
    o.step = step;
    if (opt.step) console.log(`${o.label} step.${o.step} ${msg}`);
  }
  /** stringify: 変数の内容をラベル＋データ型＋値の文字列として出力
   * @param {any} arg - 文字列化する変数
   * @returns {string}
   */
  function stringify(arg) {
    /** recursive: 変数の内容を再帰的にメッセージ化
     * @param {any} arg - 内容を表示する変数
     * @param {number} depth=0 - 階層の深さ
     * @param {string} label - メンバ名または添字
     */
    const recursive = (arg, depth = 0, label = '') => {
      // データ型の判定
      let type = String(Object.prototype.toString.call(arg).slice(8, -1));
      switch (type) {
        case 'Number': if (Number.isNaN(arg)) type = 'NaN'; break;
        case 'Function': if (!('prototype' in arg)) type = 'Arrow'; break;
      }
      // ラベル＋データ型＋値の出力
      let indent = '  '.repeat(depth);
      switch (type) {
        case 'Object':
          msg.push(`${indent}${label.length > 0 ? label + ': ' : ''}{`);
          for (let mn in arg) recursive(arg[mn], depth + 1, mn);
          msg.push(`${indent}}`);
          break;
        case 'Array':
          msg.push(`${indent}${label.length > 0 ? label + ': ' : ''}[`);
          for (let i = 0; i < arg.length; i++) recursive(arg[i], depth + 1, String(i));
          msg.push(`${indent}]`);
          break;
        default:
          let val = typeof arg === 'function' ? `"${arg.toString()}"` : (typeof arg === 'string' ? `"${arg}"` : arg);
          // Class Sheetのメソッドのように、toStringが効かないnative codeは出力しない
          if (typeof val !== 'string' || val.indexOf('[native code]') < 0) {
            msg.push(`${indent}${label.length > 0 ? label + ': ' : ''}${val}(${type})`);
          }
      }
    }
    const msg = [];
    recursive(arg);
    return msg.join('\n');
  }
}
/** 日時を指定形式の文字列にして返す
 * @param {string|Date} arg - 変換元の日時
 * @param {string} [format='yyyy-MM-ddThh:mm:ss.nnnZ'] - 日時を指定する文字列。年:y,月:M,日:d,時:h,分:m,秒:s,ミリ秒:n,タイムゾーン:Z
 * @returns {string} 指定形式に変換された文字列。無効な日付なら長さ0の文字列
 *
 * @example
 * ```
 * "1965/9/5"[yy/MM/dd hh:mm:ss.nnn] ⇒ "65/09/05 00:00:00.000"
 * "1965/9/5"[yyyy-MM-dd] ⇒ "1965-09-05"
 * "1965/9/5"[hh:mm] ⇒ "00:00"
 * "1977-03-04"[yy/MM/dd hh:mm:ss.nnn] ⇒ "77/03/04 09:00:00.000"
 * "1977-03-04"[yyyy-MM-dd] ⇒ "1977-03-04"
 * "1977-03-04"[hh:mm] ⇒ "09:00"
 * 1688189258262[yy/MM/dd hh:mm:ss.nnn] ⇒ "23/07/01 14:27:38.262"
 * 1688189258262[yyyy-MM-dd] ⇒ "2023-07-01"
 * 1688189258262[hh:mm] ⇒ "14:27"
 * "Sat Jul 01 2023 14:16:30 GMT+0900"[yy/MM/dd hh:mm:ss.nnn] ⇒ "23/07/01 14:16:30.000"
 * "Sat Jul 01 2023 14:16:30 GMT+0900"[yyyy-MM-dd] ⇒ "2023-07-01"
 * "Sat Jul 01 2023 14:16:30 GMT+0900"[hh:mm] ⇒ "14:16"
 * "12:34"[yy/MM/dd hh:mm:ss.nnn] ⇒ ""
 * "12:34"[yyyy-MM-dd] ⇒ ""
 * "12:34"[hh:mm] ⇒ ""
 * ```
 */
function toLocale(arg,format='yyyy-MM-ddThh:mm:ss.nnnZ'){
  const v = {rv:format};
  try {

    let dObj = whichType(arg,'Date') ? arg : new Date(arg);
    //dObj = String(Object.prototype.toString.call(arg).slice(8,-1)) !== 'Date' ? arg : new Date(arg);

    v.step = 1; // 無効な日付なら空文字列を返して終了
    if( isNaN(dObj.getTime()) ) return '';

    v.local = { // 地方時ベース
      y: dObj.getFullYear(),
      M: dObj.getMonth()+1,
      d: dObj.getDate(),
      h: dObj.getHours(),
      m: dObj.getMinutes(),
      s: dObj.getSeconds(),
      n: dObj.getMilliseconds(),
      Z: Math.abs(dObj.getTimezoneOffset())
    }
    // タイムゾーン文字列の作成
    v.local.Z = v.local.Z === 0 ? 'Z'
    : ((dObj.getTimezoneOffset() < 0 ? '+' : '-')
    + ('0' + Math.floor(v.local.Z / 60)).slice(-2)
    + ':' + ('0' + (v.local.Z % 60)).slice(-2));

    v.step = 2; // 日付文字列作成
    for( v.x in v.local ){
      v.m = v.rv.match(new RegExp(v.x+'+'));
      if( v.m ){
        v.str = v.m[0].length > 1
          ? ('000'+v.local[v.x]).slice(-v.m[0].length)
          : String(v.local[v.x]);
        v.rv = v.rv.replace(v.m[0],v.str);
      }
    }

    v.step = 3; // 終了処理
    return v.rv;

  } catch(e){
    console.error(e,v);
    return e;
  }
}
/** 変数の型を判定
 *
 * - 引数"is"が指定された場合、判定対象が"is"と等しいかの真偽値を返す。
 *
 * @param {any} arg - 判定対象の変数
 * @param {string} [is] - 想定される型(型名の大文字小文字は意識不要)
 * @returns {string|boolean} - 型の名前。is指定有りなら判定対象が想定型かの真偽値
 *
 * @example
 * ```
 * let a = 10;
 * whichType(a);  // 'Number'
 * whichType(a,'string'); // false
 * ```
 *
 * <b>確認済戻り値一覧</b>
 *
 * オブジェクトは型名が返るので、限定列挙は困難。以下は確認済みの戻り値のみ記載。
 *
 * | 型名 | 戻り値 | 備考 |
 * | :-- | :-- | :-- |
 * | 文字列 | String |  |
 * | 数値 | Number |  |
 * | NaN | NaN |  |
 * | 長整数 | BigInt |  |
 * | 論理値 | Boolean |  |
 * | シンボル | Symbol |  |
 * | undefined | Undefined | 先頭大文字 |
 * | Null | Null |  |
 * | オブジェクト | Object |  |
 * | 配列 | Array |  |
 * | 関数 | Function |  |
 * | アロー関数 | Arrow |  |
 * | エラー | Error | RangeError等も'Error' |
 * | Date型 | Date |  |
 * | Promise型 | Promise |  |
 *
 * - Qiita [JavaScriptの型などの判定いろいろ](https://qiita.com/amamamaou/items/ef0b797156b324bb4ef3)
 *
 */
function whichType(arg,is){
  let rv = String(Object.prototype.toString.call(arg).slice(8,-1));
  switch(rv){
    case 'Number': if(Number.isNaN(arg)) rv = 'NaN'; break;
    case 'Function': if(!('prototype' in arg)) rv = 'Arrow'; break;
  }
  if( typeof is === 'string' ){
    return rv.toLowerCase() === is.toLowerCase();
  } else {
    return rv;
  }
}
/** drawGraph: 横棒グラフを作成
 * @param {Object[]} data
 * @param {string} data.key - ラベル
 * @param {number} data.value - 値
 * @param {string} qsStr - 配置する親要素のCSSセレクタ
 * @returns {null|Error}
 */
function drawGraph(data,qsStr) {
  const v = { whois: 'drawGraph', rv: null, content:[]};
  dev.start(v.whois);
  try {

    // -------------------------------------------------------------
    dev.step(1); // 引数の存否確認、データ型チェック ＋ ワークの準備
    // -------------------------------------------------------------
    dev.step(1.1);  // 最大値を計算
    v.max = Math.max(...data.map(item => item.value));

    data.forEach(o => {
      v.content.push({tag:'tr',children:[
        {tag:'td',attr:{class:'label'},text:o.key},
        {tag:'td',attr:{class:'bar'},children:[
          {tag:'span',style:{width:Math.floor(o.value/v.max*100)+'%'},text:o.value}
        ]}
      ]});
    });
    document.querySelector(qsStr).innerHTML = '';
    createElement({tag:'table',children:v.content},qsStr);

    dev.end(); // 終了処理
    return v.rv;

  } catch (e) { dev.error(e); return e; }
}
const dev = devTools();

// 集計表の作成
function createTable(data){
  const v = { whois: 'createTable', rv: null,
    cols: ['テント','体育館','宿泊計','日帰り','参加者計'],
    rows: ['1年生','2年生','3年生','4年生','5年生','6年生',
      '在校生計','卒業生','未就学児','保護者','不明','合計'],
  };
  try {

    /*
    // localStorageからデータを取得
    const lStorage = JSON.parse(localStorage.getItem(config.systemName) || '{}');

    // データが無い場合は空配列
    const data = typeof lStorage['集計表'] === 'undefined'
    ? [] : lStorage['集計表'];
    */

    // ヘッダの作成
    v.header = [{tag:'th'}];
    v.cols.forEach(c => v.header.push({tag:'th',attr:{class:'vertical'},text:c}));

    // 応募者数テーブルデータの作成
    v.body = [];
    // 申込口数別集計
    v.body.push({tag:'tr',children:[
      {tag:'th',attr:{colspan:6},text:'申込口数の集計'}
    ]});
    v.row = [{tag:'th'}];
    v.cols.forEach(c => {
      v.o = data.find(o => o.X === c && o.Y === '申込口数');
      v.val = v.o ? v.o.num : 0;
      v.e = {tag:'td',text:v.val};
      if( c === '宿泊計' || c === '参加者計' ){
        v.e.attr = {class:'sum'}; // 合計数表示セル
      }
      v.row.push(v.e);
    });
    v.body.push({tag:'tr',children:v.row});

    // 参加者数集計
    v.body.push({tag:'tr',children:[
      {tag:'th',attr:{colspan:6},text:'参加者数の集計'}
    ]});
    v.rows.forEach(r => {
      v.isSum = r === '在校生計' || r === '合計';
      v.row = [{tag:'th',text:r}];
      v.cols.forEach(c => {
        v.o = data.find(o => o.X === c && o.Y === r);
        v.val = v.o ? v.o.num : 0;
        v.e = {tag:'td',text:v.val};
        if( v.isSum || c === '宿泊計' || c === '参加者計' ){
          v.e.attr = {class:'sum'}; // 合計数表示セル
        }
        v.row.push(v.e);
      });
      v.body.push({tag:'tr',children:v.row});
    });
    console.log(v.body);

    // テーブルの作成
    document.querySelector('.participant').innerHTML = '';
    v.r = createElement({tag:'table',children:[
      {tag:'thead',children:[{tag:'tr',children:v.header}]},
      {tag:'tbody',children:v.body},
    ]},'.participant');
    if( v.r instanceof Error ) throw v.r;

    // スタッフ数テーブルデータの作成
    v.o = data.find(o => o.X === '参加者' && o.Y === 'ボランティア');
    v.staff = v.o ? Number(v.o.num) : 0;
    v.o = data.find(o => o.X === 'おやじ' && o.Y === 'ボランティア');
    v.oyaji = v.o ? Number(v.o.num) : 0;

    document.querySelector('.staff').innerHTML = '';
    v.r = createElement({tag:'table',children:[
      {tag:'thead',children:[{tag:'tr',children:[
        {tag:'th'},
        {tag:'th',text:'参加者'},
        {tag:'th',text:'おやじ'},
        {tag:'th',text:'合計'},
      ]}]},
      {tag:'tbody',children:[{tag:'tr',children:[
        {tag:'th',text:'ボランティア'},
        {tag:'td',text:v.staff},
        {tag:'td',text:v.oyaji},
        {tag:'td',text:v.staff+v.oyaji},
      ]}]},
    ]},'.staff');
    if( v.r instanceof Error ) throw v.r;

  } catch (e) { console.error(e); return e; }
}

window.addEventListener('DOMContentLoaded', () => {
  const v = {};
  fetchPublic('summary').then(data => {
    console.log(data);

    // -----------------------
    // 応募者数集計
    // -----------------------
    createTable(data['集計表']);

    // -----------------------
    // 日別応募数の推移
    // -----------------------
    // 対象データの抽出、整形
    v.daily = data['応募・アクセス数集計']
    .filter(x => x.type === "日別応募数");
    v.daily.forEach(x => x.key = toLocale(x.key,'MM/dd'));
    v.daily = v.daily.filter(x => x.key >= '10/06');  // 本番日以降
    // 横棒グラフ表示
    drawGraph(v.daily.sort((a,b) => a.key.localeCompare(b.key)),'#dailyGraph');

    // -----------------------
    // 時間帯別応募数
    // -----------------------
    v.data = data['応募・アクセス数集計']
    .filter(x => x.type === "時間帯別応募数");
    v.hourly = [];
    for( v.i=4 ; v.i<28 ; v.i++ ){
      v.o = v.data.find(x => x.key === v.i);
      v.value = v.o ? v.o.value : 0;
      if( !v.value ) v.value = 0;
      v.hourly.push({
        key: ('0'+v.i).slice(-2) + '時台',
        value: v.value
      });
    }
    // 横棒グラフ表示
    drawGraph(v.hourly,'#hourlyGraph');
  })
  .catch(e => console.error(e));
});
</script>
</html>
